Outer loop iteration: 1 (seed=41)
sdiff_cons=0.25
INFO - distributed_c10d.py - 2025-10-13 11:50:07,411 - Added key: store_based_barrier_key:1 to store for rank: 0
INFO - distributed_c10d.py - 2025-10-13 11:50:07,411 - Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 1 nodes.
INFO - main_bpda_eot.py - 2025-10-13 11:50:07,464 - Using device: cuda:0
INFO - main_bpda_eot.py - 2025-10-13 11:50:07,464 - Writing log file to logs/CIFAR10/pgd_eot/l-1_512x1_it_20_eot_150_20/model_opt_method_aaopt_total_1_forward_0.25_pur_20/lr_0.1_init_False_lambda_1.0_seed_41
INFO - main_bpda_eot.py - 2025-10-13 11:50:07,464 - Using args: Namespace(log='logs/CIFAR10/pgd_eot/l-1_512x1_it_20_eot_150_20/model_opt_method_aaopt_total_1_forward_0.25_pur_20/lr_0.1_init_False_lambda_1.0_seed_41', config='defalt.yml', seed=41, data_seed=['41'], verbose='info', dataset='CIFAR10', batch_size=8, clf_net='wideresnet-28-10', subset_size=512, purify_iter=20, apprx_iter=1, purify_model='opt', purify_method='aaopt', total_steps=1, forward_steps=0.25, loss_lambda=1.0, lr=0.1, init=False, att_method='pgd_eot', att_lp_norm=-1, att_eps=0.031373, att_step=1, att_n_iter=20, att_alpha=0.00784313725490196, eot_defense_reps=150, eot_attack_reps=20, network_pkl='https://nvlabs-fi-cdn.nvidia.com/edm/pretrained/edm-cifar10-32x32-uncond-vp.pkl', sigma_min=None, sigma_max=None, sdiff_cons=0.25, ex_grad=1, no_stop_grad=0, diff_reversed=1, aa=1, seq_t=0, use_full_steps=0, sdiff_net='./pretrained_models/cifar10_score_DIFF_JOINT_wideresnet-28-10_', use_aa_rand=0, device=device(type='cuda', index=0))
Files already downloaded and verified
using cifar10 wideresnet-28-10...
=> loading cifar10-diffusion checkpoint from 'https://nvlabs-fi-cdn.nvidia.com/edm/pretrained/edm-cifar10-32x32-uncond-vp.pkl'
loading perturbation model from provided path:  ./pretrained_models/cifar10_score_DIFF_JOINT_wideresnet-28-10_
perturbation model loaded
EPS:  0.031373
SDIFF:  0.25
Using AutoAttack ..... 
Traceback (most recent call last):
  File "/home/dweseg2/t_folder/AAOpt_code/main_bpda_eot.py", line 371, in <module>
    main()
  File "/home/dweseg2/t_folder/AAOpt_code/main_bpda_eot.py", line 210, in main
    x_adv, y_adv = evaluate_autoattack(args, val_dataloader, clf, trans_to_clf, score)
  File "/home/dweseg2/t_folder/AAOpt_code/eval_aa.py", line 37, in evaluate_autoattack
    base_model = Purify_Model(clf, trans_to_clf, scorenet, args).to(args.device)
TypeError: Purify_Model.__init__() missing 2 required positional arguments: 'sdiff_sampler' and 'args'
ERROR:torch.distributed.elastic.multiprocessing.api:failed (exitcode: 1) local_rank: 0 (pid: 1535234) of binary: /home/dweseg2/sopt/bin/python
Traceback (most recent call last):
  File "/home/dweseg2/sopt/bin/torchrun", line 8, in <module>
    sys.exit(main())
  File "/home/dweseg2/sopt/lib/python3.10/site-packages/torch/distributed/elastic/multiprocessing/errors/__init__.py", line 346, in wrapper
    return f(*args, **kwargs)
  File "/home/dweseg2/sopt/lib/python3.10/site-packages/torch/distributed/run.py", line 794, in main
    run(args)
  File "/home/dweseg2/sopt/lib/python3.10/site-packages/torch/distributed/run.py", line 785, in run
    elastic_launch(
  File "/home/dweseg2/sopt/lib/python3.10/site-packages/torch/distributed/launcher/api.py", line 134, in __call__
    return launch_agent(self._config, self._entrypoint, list(args))
  File "/home/dweseg2/sopt/lib/python3.10/site-packages/torch/distributed/launcher/api.py", line 250, in launch_agent
    raise ChildFailedError(
torch.distributed.elastic.multiprocessing.errors.ChildFailedError: 
============================================================
main_bpda_eot.py FAILED
------------------------------------------------------------
Failures:
  <NO_OTHER_FAILURES>
------------------------------------------------------------
Root Cause (first observed failure):
[0]:
  time      : 2025-10-13_11:50:14
  host      : octopus.cs.uic.edu
  rank      : 0 (local_rank: 0)
  exitcode  : 1 (pid: 1535234)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
============================================================
Done with sdiff_cons=0.25
 
Completed outer loop iteration: 1 (seed=41)
===============================
Outer loop iteration: 1 (seed=41)
sdiff_cons=0.25
INFO - distributed_c10d.py - 2025-10-13 11:51:31,908 - Added key: store_based_barrier_key:1 to store for rank: 0
INFO - distributed_c10d.py - 2025-10-13 11:51:31,908 - Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 1 nodes.
INFO - main_bpda_eot.py - 2025-10-13 11:51:31,961 - Using device: cuda:0
INFO - main_bpda_eot.py - 2025-10-13 11:51:31,961 - Writing log file to logs/CIFAR10/pgd_eot/l-1_512x1_it_20_eot_150_20/model_opt_method_aaopt_total_1_forward_0.25_pur_20/lr_0.1_init_False_lambda_1.0_seed_41
INFO - main_bpda_eot.py - 2025-10-13 11:51:31,961 - Using args: Namespace(log='logs/CIFAR10/pgd_eot/l-1_512x1_it_20_eot_150_20/model_opt_method_aaopt_total_1_forward_0.25_pur_20/lr_0.1_init_False_lambda_1.0_seed_41', config='defalt.yml', seed=41, data_seed=['41'], verbose='info', dataset='CIFAR10', batch_size=8, clf_net='wideresnet-28-10', subset_size=512, purify_iter=20, apprx_iter=1, purify_model='opt', purify_method='aaopt', total_steps=1, forward_steps=0.25, loss_lambda=1.0, lr=0.1, init=False, att_method='pgd_eot', att_lp_norm=-1, att_eps=0.031373, att_step=1, att_n_iter=20, att_alpha=0.00784313725490196, eot_defense_reps=150, eot_attack_reps=20, network_pkl='https://nvlabs-fi-cdn.nvidia.com/edm/pretrained/edm-cifar10-32x32-uncond-vp.pkl', sigma_min=None, sigma_max=None, sdiff_cons=0.25, ex_grad=1, no_stop_grad=0, diff_reversed=1, aa=1, seq_t=0, use_full_steps=0, sdiff_net='./pretrained_models/cifar10_score_DIFF_JOINT_wideresnet-28-10_', use_aa_rand=0, device=device(type='cuda', index=0))
Files already downloaded and verified
using cifar10 wideresnet-28-10...
=> loading cifar10-diffusion checkpoint from 'https://nvlabs-fi-cdn.nvidia.com/edm/pretrained/edm-cifar10-32x32-uncond-vp.pkl'
loading perturbation model from provided path:  ./pretrained_models/cifar10_score_DIFF_JOINT_wideresnet-28-10_
perturbation model loaded
EPS:  0.031373
SDIFF:  0.25
Using AutoAttack ..... 
Running AutoAttack... at 0.031373
using custom version including apgd-ce, apgd-t, fab-t, square.
Warning: it seems to be a randomized defense! Please use version="rand". See flags_doc.md for details.
Warning: it seems to be a dynamic defense! The evaluation with AutoAttack might be insufficient. See flags_doc.md for details.
initial accuracy: 88.87%
apgd-ce - 1/57 - 6 out of 8 successfully perturbed
apgd-ce - 2/57 - 6 out of 8 successfully perturbed
apgd-ce - 3/57 - 4 out of 8 successfully perturbed
apgd-ce - 4/57 - 7 out of 8 successfully perturbed
apgd-ce - 5/57 - 7 out of 8 successfully perturbed
apgd-ce - 6/57 - 6 out of 8 successfully perturbed
apgd-ce - 7/57 - 3 out of 8 successfully perturbed
apgd-ce - 8/57 - 5 out of 8 successfully perturbed
apgd-ce - 9/57 - 7 out of 8 successfully perturbed
apgd-ce - 10/57 - 6 out of 8 successfully perturbed
apgd-ce - 11/57 - 7 out of 8 successfully perturbed
apgd-ce - 12/57 - 5 out of 8 successfully perturbed
apgd-ce - 13/57 - 6 out of 8 successfully perturbed
apgd-ce - 14/57 - 5 out of 8 successfully perturbed
apgd-ce - 15/57 - 5 out of 8 successfully perturbed
apgd-ce - 16/57 - 6 out of 8 successfully perturbed
apgd-ce - 17/57 - 5 out of 8 successfully perturbed
apgd-ce - 18/57 - 4 out of 8 successfully perturbed
apgd-ce - 19/57 - 7 out of 8 successfully perturbed
apgd-ce - 20/57 - 3 out of 8 successfully perturbed
apgd-ce - 21/57 - 4 out of 8 successfully perturbed
apgd-ce - 22/57 - 5 out of 8 successfully perturbed
apgd-ce - 23/57 - 3 out of 8 successfully perturbed
apgd-ce - 24/57 - 4 out of 8 successfully perturbed
apgd-ce - 25/57 - 4 out of 8 successfully perturbed
apgd-ce - 26/57 - 3 out of 8 successfully perturbed
apgd-ce - 27/57 - 3 out of 8 successfully perturbed
apgd-ce - 28/57 - 7 out of 8 successfully perturbed
apgd-ce - 29/57 - 4 out of 8 successfully perturbed
apgd-ce - 30/57 - 4 out of 8 successfully perturbed
apgd-ce - 31/57 - 4 out of 8 successfully perturbed
apgd-ce - 32/57 - 5 out of 8 successfully perturbed
apgd-ce - 33/57 - 7 out of 8 successfully perturbed
apgd-ce - 34/57 - 7 out of 8 successfully perturbed
apgd-ce - 35/57 - 5 out of 8 successfully perturbed
apgd-ce - 36/57 - 6 out of 8 successfully perturbed
apgd-ce - 37/57 - 4 out of 8 successfully perturbed
apgd-ce - 38/57 - 5 out of 8 successfully perturbed
apgd-ce - 39/57 - 5 out of 8 successfully perturbed
apgd-ce - 40/57 - 3 out of 8 successfully perturbed
apgd-ce - 41/57 - 3 out of 8 successfully perturbed
apgd-ce - 42/57 - 3 out of 8 successfully perturbed
apgd-ce - 43/57 - 6 out of 8 successfully perturbed
apgd-ce - 44/57 - 6 out of 8 successfully perturbed
apgd-ce - 45/57 - 2 out of 8 successfully perturbed
apgd-ce - 46/57 - 5 out of 8 successfully perturbed
apgd-ce - 47/57 - 6 out of 8 successfully perturbed
apgd-ce - 48/57 - 1 out of 8 successfully perturbed
apgd-ce - 49/57 - 5 out of 8 successfully perturbed
apgd-ce - 50/57 - 6 out of 8 successfully perturbed
apgd-ce - 51/57 - 5 out of 8 successfully perturbed
apgd-ce - 52/57 - 4 out of 8 successfully perturbed
apgd-ce - 53/57 - 5 out of 8 successfully perturbed
apgd-ce - 54/57 - 6 out of 8 successfully perturbed
apgd-ce - 55/57 - 3 out of 8 successfully perturbed
apgd-ce - 56/57 - 6 out of 8 successfully perturbed
apgd-ce - 57/57 - 3 out of 7 successfully perturbed
robust accuracy after APGD-CE: 34.77% (total time 3001.7 s)
apgd-t - 1/23 - 0 out of 8 successfully perturbed
apgd-t - 2/23 - 0 out of 8 successfully perturbed
apgd-t - 3/23 - 3 out of 8 successfully perturbed
apgd-t - 4/23 - 0 out of 8 successfully perturbed
apgd-t - 5/23 - 2 out of 8 successfully perturbed
apgd-t - 6/23 - 1 out of 8 successfully perturbed
apgd-t - 7/23 - 0 out of 8 successfully perturbed
apgd-t - 8/23 - 0 out of 8 successfully perturbed
apgd-t - 9/23 - 1 out of 8 successfully perturbed
apgd-t - 10/23 - 0 out of 8 successfully perturbed
apgd-t - 11/23 - 0 out of 8 successfully perturbed
apgd-t - 12/23 - 1 out of 8 successfully perturbed
apgd-t - 13/23 - 2 out of 8 successfully perturbed
apgd-t - 14/23 - 3 out of 8 successfully perturbed
apgd-t - 15/23 - 5 out of 8 successfully perturbed
apgd-t - 16/23 - 3 out of 8 successfully perturbed
apgd-t - 17/23 - 3 out of 8 successfully perturbed
apgd-t - 18/23 - 3 out of 8 successfully perturbed
apgd-t - 19/23 - 0 out of 8 successfully perturbed
apgd-t - 20/23 - 2 out of 8 successfully perturbed
apgd-t - 21/23 - 2 out of 8 successfully perturbed
apgd-t - 22/23 - 1 out of 8 successfully perturbed
apgd-t - 23/23 - 0 out of 2 successfully perturbed
robust accuracy after APGD-T: 28.52% (total time 6402.1 s)
fab-t - 1/19 - 0 out of 8 successfully perturbed
fab-t - 2/19 - 0 out of 8 successfully perturbed
fab-t - 3/19 - 0 out of 8 successfully perturbed
fab-t - 4/19 - 0 out of 8 successfully perturbed
fab-t - 5/19 - 0 out of 8 successfully perturbed
fab-t - 6/19 - 0 out of 8 successfully perturbed
fab-t - 7/19 - 0 out of 8 successfully perturbed
fab-t - 8/19 - 0 out of 8 successfully perturbed
fab-t - 9/19 - 0 out of 8 successfully perturbed
fab-t - 10/19 - 0 out of 8 successfully perturbed
fab-t - 11/19 - 0 out of 8 successfully perturbed
fab-t - 12/19 - 0 out of 8 successfully perturbed
fab-t - 13/19 - 0 out of 8 successfully perturbed
fab-t - 14/19 - 0 out of 8 successfully perturbed
fab-t - 15/19 - 0 out of 8 successfully perturbed
fab-t - 16/19 - 1 out of 8 successfully perturbed
fab-t - 17/19 - 0 out of 8 successfully perturbed
fab-t - 18/19 - 0 out of 8 successfully perturbed
fab-t - 19/19 - 0 out of 2 successfully perturbed
robust accuracy after FAB-T: 28.32% (total time 14044.3 s)
square - 1/19 - 0 out of 8 successfully perturbed
square - 2/19 - 0 out of 8 successfully perturbed
square - 3/19 - 0 out of 8 successfully perturbed
square - 4/19 - 0 out of 8 successfully perturbed
square - 5/19 - 0 out of 8 successfully perturbed
square - 6/19 - 0 out of 8 successfully perturbed
square - 7/19 - 0 out of 8 successfully perturbed
square - 8/19 - 0 out of 8 successfully perturbed
square - 9/19 - 0 out of 8 successfully perturbed
square - 10/19 - 0 out of 8 successfully perturbed
square - 11/19 - 0 out of 8 successfully perturbed
square - 12/19 - 0 out of 8 successfully perturbed
square - 13/19 - 0 out of 8 successfully perturbed
square - 14/19 - 0 out of 8 successfully perturbed
square - 15/19 - 0 out of 8 successfully perturbed
square - 16/19 - 0 out of 8 successfully perturbed
square - 17/19 - 0 out of 8 successfully perturbed
square - 18/19 - 0 out of 8 successfully perturbed
square - 19/19 - 0 out of 1 successfully perturbed
robust accuracy after SQUARE: 28.32% (total time 30420.8 s)
max Linf perturbation: 0.03137, nan in tensor: 0, max: 1.00000, min: 0.00000
robust accuracy: 28.32%
  0%|          | 0/64 [00:00<?, ?it/s]  2%|▏         | 1/64 [00:06<06:56,  6.61s/it]  3%|▎         | 2/64 [00:12<06:32,  6.33s/it]  5%|▍         | 3/64 [00:18<06:20,  6.24s/it]  6%|▋         | 4/64 [00:25<06:12,  6.20s/it]  8%|▊         | 5/64 [00:31<06:04,  6.18s/it]  9%|▉         | 6/64 [00:37<05:57,  6.17s/it] 11%|█         | 7/64 [00:43<05:51,  6.16s/it] 12%|█▎        | 8/64 [00:49<05:45,  6.16s/it] 14%|█▍        | 9/64 [00:55<05:38,  6.16s/it] 16%|█▌        | 10/64 [01:01<05:32,  6.16s/it] 17%|█▋        | 11/64 [01:08<05:26,  6.16s/it] 19%|█▉        | 12/64 [01:14<05:20,  6.16s/it] 20%|██        | 13/64 [01:20<05:14,  6.16s/it] 22%|██▏       | 14/64 [01:26<05:08,  6.16s/it] 23%|██▎       | 15/64 [01:32<05:02,  6.17s/it] 25%|██▌       | 16/64 [01:38<04:55,  6.16s/it] 27%|██▋       | 17/64 [01:45<04:49,  6.16s/it] 28%|██▊       | 18/64 [01:51<04:43,  6.16s/it] 30%|██▉       | 19/64 [01:57<04:37,  6.16s/it] 31%|███▏      | 20/64 [02:03<04:31,  6.16s/it] 33%|███▎      | 21/64 [02:09<04:25,  6.17s/it] 34%|███▍      | 22/64 [02:15<04:18,  6.16s/it] 36%|███▌      | 23/64 [02:22<04:12,  6.16s/it] 38%|███▊      | 24/64 [02:28<04:06,  6.17s/it] 39%|███▉      | 25/64 [02:34<04:00,  6.17s/it] 41%|████      | 26/64 [02:40<03:54,  6.17s/it] 42%|████▏     | 27/64 [02:46<03:48,  6.17s/it] 44%|████▍     | 28/64 [02:52<03:42,  6.17s/it] 45%|████▌     | 29/64 [02:59<03:35,  6.17s/it] 47%|████▋     | 30/64 [03:05<03:29,  6.17s/it] 48%|████▊     | 31/64 [03:11<03:23,  6.16s/it] 50%|█████     | 32/64 [03:17<03:17,  6.16s/it] 52%|█████▏    | 33/64 [03:23<03:11,  6.16s/it] 53%|█████▎    | 34/64 [03:29<03:04,  6.17s/it] 55%|█████▍    | 35/64 [03:36<02:58,  6.17s/it] 56%|█████▋    | 36/64 [03:42<02:52,  6.17s/it] 58%|█████▊    | 37/64 [03:48<02:46,  6.17s/it] 59%|█████▉    | 38/64 [03:54<02:40,  6.17s/it] 61%|██████    | 39/64 [04:00<02:34,  6.17s/it] 62%|██████▎   | 40/64 [04:06<02:28,  6.17s/it] 64%|██████▍   | 41/64 [04:13<02:21,  6.17s/it] 66%|██████▌   | 42/64 [04:19<02:15,  6.17s/it] 67%|██████▋   | 43/64 [04:25<02:09,  6.17s/it] 69%|██████▉   | 44/64 [04:31<02:03,  6.17s/it] 70%|███████   | 45/64 [04:37<01:57,  6.17s/it] 72%|███████▏  | 46/64 [04:43<01:51,  6.17s/it] 73%|███████▎  | 47/64 [04:50<01:44,  6.17s/it] 75%|███████▌  | 48/64 [04:56<01:38,  6.17s/it] 77%|███████▋  | 49/64 [05:02<01:32,  6.17s/it] 78%|███████▊  | 50/64 [05:08<01:26,  6.17s/it] 80%|███████▉  | 51/64 [05:14<01:20,  6.17s/it] 81%|████████▏ | 52/64 [05:20<01:14,  6.17s/it] 83%|████████▎ | 53/64 [05:27<01:07,  6.17s/it] 84%|████████▍ | 54/64 [05:33<01:01,  6.17s/it] 86%|████████▌ | 55/64 [05:39<00:55,  6.17s/it] 88%|████████▊ | 56/64 [05:45<00:49,  6.17s/it] 89%|████████▉ | 57/64 [05:51<00:43,  6.17s/it] 91%|█████████ | 58/64 [05:57<00:37,  6.17s/it] 92%|█████████▏| 59/64 [06:04<00:30,  6.17s/it] 94%|█████████▍| 60/64 [06:10<00:24,  6.17s/it] 95%|█████████▌| 61/64 [06:16<00:18,  6.17s/it] 97%|█████████▋| 62/64 [06:22<00:12,  6.17s/it] 98%|█████████▊| 63/64 [06:28<00:06,  6.17s/it]100%|██████████| 64/64 [06:34<00:00,  6.17s/it]100%|██████████| 64/64 [06:35<00:00,  6.17s/it]
ACCS:  [92.96875   36.328125  89.453125  89.2578125  1.       ]
Std Acc:  92.96875
Rob Acc:  36.328125
Purif Std Acc:  89.453125
Purif Rob Acc:  89.2578125
Done with sdiff_cons=0.25
 
Completed outer loop iteration: 1 (seed=41)
===============================
./sh/run_ep8_aa.sh: line 23: syntax error near unexpected token `('
./sh/run_ep8_aa.sh: line 23: `ted outer loop iteration: $run (seed=$seed)"'
